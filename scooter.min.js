// Scooter v1.0.0 - Maps functionality for your HTML | Joshua Woehlke | github.com/userexec/scooter | Licensed MIT */
!function(){window.scooter||(window.scooter=function(t){if(t=t||{},t.plate=t.plate||!1,t.insertInto=t.insertInto||t.plate.parent(),t.viewportWidth=t.viewportWidth||"100%",t.viewportHeight=t.viewportHeight||"100%",t.viewportBackground=t.viewportBackground||"linear-gradient(to bottom, #b8c6df 0%,#6d88b7 100%)",t.initialScale=t.initialScale||1,t.animations=t.animations||{},t.maxZoom=t.maxZoom||4,t.minZoom=t.minZoom||1,t.pan=t.pan||!0,t.startAt=t.startAt||"origin",t.targets=t.targets||!1,!t.plate)return console.log("Scooter - Config error: No plate specified. Please pass a jQuery object."),!1;if(t.targets)for(var e in t.targets)"object"==typeof t.targets[e]&&(t.targets[e].duration=t.targets[e].duration||!1,t.targets[e].easing=t.targets[e].easing||!1,t.targets[e].scale=t.targets[e].scale||!1,t.targets[e].travelScale=t.targets[e].travelScale||!1,t.targets[e].scaleDuration=t.targets[e].scaleDuration||!1,t.targets[e].callback=t.targets[e].callback||!1);var o={id:Math.floor(1e6*Math.random()),config:t,elements:{},state:{currentTarget:"center",currentScale:t.initialScale,waypoints:[]},trigger:function(t){var e;this.config.targets[t]&&("string"==typeof this.config.targets[t]||"function"==typeof this.config.targets[t]?(e="function"==typeof this.config.targets[t]?this.config.targets[t]():this.config.targets[t],scooter.movement.scootTo(this,{target:e})):"object"==typeof o.config.targets[t]&&(e="function"==typeof this.config.targets[t].target?this.config.targets[t].target():this.config.targets[t].target,scooter.movement.scootTo(this,this.config.targets[t])))}};return scooter.actions.appendElements(o),scooter.actions.attachTargets(o),scooter.actions.attachEvents(o),"origin"!==t.startAt&&scooter.movement.scootTo(o,{target:t.startAt,scale:1,duration:0}),o},scooter.actions={appendElements:function(t){var e=t.config.insertInto.css("position");"BODY"!==t.config.insertInto.prop("tagName")&&"absolute"!==e&&"fixed"!==e&&t.config.insertInto.css("position","relative"),$("<div></div>",{id:"scooter-viewport-"+t.id}).css({width:t.config.viewportWidth,height:t.config.viewportHeight,background:t.config.viewportBackground,position:"absolute",top:"0",left:"0",overflow:"hidden","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"}).appendTo(t.config.insertInto),t.elements.viewport=$("#scooter-viewport-"+t.id),$("<div></div>",{id:"scooter-scaler-"+t.id}).css({width:t.config.viewportWidth,height:t.config.viewportHeight,overflow:"visible"}).appendTo(t.elements.viewport),t.elements.scaler=$("#scooter-scaler-"+t.id);var o="";o=t.config.plate.attr("id")?t.config.plate.attr("id"):"scooter-plate-"+t.id,t.config.plate.attr("id",o),t.config.plate.appendTo(t.elements.scaler);var a=t.elements.plate.css("position");"absolute"!==a&&t.elements.plate.css("position","relative"),t.elements.plate=$("#"+o)},attachEvents:function(t){t.config.pan&&t.elements.plate.on("mousedown",function(e){t.state.dragXStart=e.offsetX||e.pageX,t.state.dragYStart=e.offsetY||e.pageY,t.elements.viewport.on("mousemove",function(e){t.elements.plate.stop(),scooter.movement.drag(e,t)})}),t.elements.viewport.on("wheel mousewheel DOMMouseScroll",function(e){t.config.minZoom!==t.config.maxZoom&&e.preventDefault(),scooter.movement.scale(e,t)}),t.elements.viewport.on("touchstart",function(e){t.state.dragXStart=e.originalEvent.touches[0].pageX,t.state.dragYStart=e.originalEvent.touches[0].pageY,1===e.originalEvent.touches.length?t.config.pan&&t.elements.viewport.on("touchmove",function(e){e.preventDefault(),t.elements.plate.stop(),scooter.movement.drag(e,t)}):2===e.originalEvent.touches.length&&(t.elements.viewport.off("touchmove"),t.state.scaleXStart=e.originalEvent.touches[1].pageX,t.state.scaleYStart=e.originalEvent.touches[1].pageY,t.elements.viewport.on("touchmove",function(e){e.preventDefault(),scooter.movement.scale(e,t)}))}),t.elements.viewport.on("mouseup touchend mouseout",function(){t.elements.viewport.off("mousemove touchmove")}),t.elements.plate.on("mouseup",function(){t.elements.viewport.off("mousemove")})},attachTargets:function(t){function e(e,o){$(e).click(function(){"function"==typeof o&&(o=o()),scooter.movement.scootTo(t,{target:o})})}function o(e,o){o.event=o.event||"click",$(e).on(o.event,function(){"function"==typeof o.target&&(o.target=o.target()),scooter.movement.scootTo(t,o)})}if(!t.config.targets)return!1;for(var a in t.config.targets)$(a).length&&("string"==typeof t.config.targets[a]||"function"==typeof t.config.targets[a]||"[object Array]"===Object.prototype.toString.call(t.config.targets[a])?e(a,t.config.targets[a]):"object"==typeof t.config.targets[a]&&(t.config.targets[a].target?o(a,t.config.targets[a]):console.log('Scooter - Config error: Trigger "'+a+'" improperly configured. Please see docs.')));$(window).resize(function(){scooter.movement.scootTo(t,{target:t.state.currentTarget,duration:400,easing:"linear",scale:t.state.currentScale,travelScale:t.state.currentScale,scaleDuration:400})})}},scooter.calc={currentPosition:function(t){return[t.elements.plate.offset().left-t.elements.viewport.offset().left-scooter.calc.viewportRadius(t).width,t.elements.plate.offset().top-t.elements.viewport.offset().top-scooter.calc.viewportRadius(t).height]},viewportRadius:function(t){return{height:Math.floor(t.elements.viewport.height()/2),width:Math.floor(t.elements.viewport.width()/2)}},plateRadius:function(t){return{height:Math.floor(t.elements.plate.height()/2),width:Math.floor(t.elements.plate.width()/2)}},targetCenter:function(t,e){return"function"==typeof e&&(e=e()),[Math.floor($(e).outerWidth()/2)*t.state.currentScale+($(e).offset().left-$(t.elements.plate).offset().left),Math.floor($(e).outerHeight()/2)*t.state.currentScale+($(e).offset().top-$(t.elements.plate).offset().top)]},coordinateFix:function(t,e,o){var a=[];return a[0]=-1*e[0]/o.travelScale+scooter.calc.viewportRadius(t).width,a[1]=-1*e[1]/o.travelScale+scooter.calc.viewportRadius(t).height,a},distance:function(t,e){return Math.abs(Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)))},findDurations:function(t,e){var o=[];o.push(scooter.calc.currentPosition(t));for(var a=0;a<t.state.waypoints.length;a++)o.push(t.state.waypoints[a]);o.push(e.target);for(var n=0;n<o.length;n++)"string"==typeof o[n]&&(o[n]=scooter.calc.targetCenter(t,o[n]));console.log(o);for(var i=[],r=0,s=0;s<o.length-1;s++)i.push(scooter.calc.distance(o[s],o[s+1])),r+=i[s];for(var c=[],l=0;l<i.length;l++)c.push(Math.floor(i[l]*e.duration/r));return c}},scooter.util={sanitizeConfig:function(t,e){return("number"!=typeof e.duration||!e.duration&&0!==e.duration)&&(t.config.animation&&t.config.animation.duration?e.duration=t.config.animation.duration:e.duration=800),e.easing&&"string"==typeof e.easing||(t.config.animation&&t.config.animation.easing?e.easing=t.config.animation.easing:e.easing="linear"),e.scale&&"number"==typeof e.scale||(t.config.animation&&t.config.animation.scale?e.scale=t.config.animation.scale:e.scale=1),e.travelScale&&"number"==typeof e.travelScale||(t.config.animation&&t.config.animation.travelScale?e.travelScale=t.config.animation.travelScale:e.travelScale=t.state.currentScale),("number"!=typeof e.scaleDuration||!e.scaleDuration&&0!==e.scaleDuration)&&(t.config.animation&&t.config.animation.scaleDuration?e.scaleDuration=t.config.animation.scaleDuration:e.scaleDuration=400),e.callback&&"function"==typeof e.callback||(t.config.animation&&t.config.animation.callback?e.callback=t.config.animation.callback:e.callback=function(){}),e}},scooter.movement={drag:function(t,e){var o,a;t.originalEvent.touches?(o=t.originalEvent.touches[0].pageX,a=t.originalEvent.touches[0].pageY):(o=t.offsetX||t.pageX,a=t.offsetY||t.pageY);var n=a-e.state.dragYStart,i=o-e.state.dragXStart,r=e.elements.plate.offset().top+n,s=e.elements.plate.offset().left+i;s>scooter.calc.viewportRadius(e).width+e.elements.viewport.offset().left||s<scooter.calc.viewportRadius(e).width+e.elements.viewport.offset().left-e.elements.plate.outerWidth()*e.state.currentScale||r>=scooter.calc.viewportRadius(e).height+e.elements.viewport.offset().top||r<scooter.calc.viewportRadius(e).height+e.elements.viewport.offset().top-e.elements.plate.outerHeight()*e.state.currentScale||(e.elements.plate.offset({top:r,left:s}),t.originalEvent.touches&&(e.state.dragXStart=t.originalEvent.touches[0].pageX,e.state.dragYStart=t.originalEvent.touches[0].pageY),t.originalEvent.touches||t.offsetX||(e.state.dragXStart=t.pageX,e.state.dragYStart=t.pageY))},scale:function(t,e){e.elements.plate.stop();var o,a,n,i;t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length>1?(n=Math.abs(Math.sqrt(Math.pow(e.state.scaleXStart-e.state.dragXStart,2)+Math.pow(e.state.scaleYStart-e.state.dragYStart,2))),i=Math.abs(Math.sqrt(Math.pow(t.originalEvent.touches[0].pageX-t.originalEvent.touches[1].pageX,2)+Math.pow(t.originalEvent.touches[0].pageY-t.originalEvent.touches[1].pageY,2))),o=n>i?-5:5,e.state.dragXStart=t.originalEvent.touches[0].pageX,e.state.dragYStart=t.originalEvent.touches[0].pageY,e.state.scaleXStart=t.originalEvent.touches[1].pageX,e.state.scaleYStart=t.originalEvent.touches[1].pageY):o=(t.wheelDelta||t.originalEvent.wheelDelta||-t.detail||-t.originalEvent.deltaY)/120>0?5:-5,a=e.state.currentScale+o/10,e.state.scaleLock&&!!o===e.state.scaleDelta||a>=e.config.minZoom&&a<=e.config.maxZoom&&(e.state.scaleLock=!0,e.state.scaleDelta=!!o,e.elements.scaler.css({transition:"all 300ms linear","-webkit-transition":"all 300ms linear",transform:"scale("+a+")","-webkit-transform":"scale("+a+")"}),e.state.currentScale=a,setTimeout(function(){e.state.scaleLock=!1},200))},origin:function(t,e){return e.target=[scooter.calc.viewportRadius(t).width,scooter.calc.viewportRadius(t).height],e},center:function(t,e){return e.target=[scooter.calc.plateRadius(t).width,scooter.calc.plateRadius(t).height],e},dispenseWaypoint:function(t){t.state.waypoints&&t.state.waypoints.length>0?(t.state.waypointConfig.target=t.state.waypoints[0],t.state.waypointConfig.duration=t.state.waypointDurations[0],t.state.waypoints.shift(),t.state.waypointDurations.shift(),scooter.movement.scootTo(t,t.state.waypointConfig)):scooter.movement.scootTo(t,t.state.deferredTarget)},scootTo:function(t,e){function o(o,n){t.state.currentScale!==o?(t.elements.scaler.css({transition:"all "+e.scaleDuration+"ms linear","-webkit-transition":"all "+e.scaleDuration+"ms linear",transform:"scale("+o+")","-webkit-transform":"scale("+o+")"}),setTimeout(function(){a(o,n)},e.scaleDuration)):n()}function a(e,o){t.elements.plate[0].getBoundingClientRect().width/t.elements.plate.width()===e?(t.state.currentScale=e,o()):setTimeout(function(){a(e,o)},100)}function n(o){var a;"string"==typeof e.target?a=scooter.calc.coordinateFix(t,scooter.calc.targetCenter(t,e.target),e):"[object Array]"===Object.prototype.toString.call(e.target)&&(a=scooter.calc.coordinateFix(t,e.target,e)),t.elements.plate.stop().animate({top:a[1],left:a[0]},e.duration,e.easing,o)}e=scooter.util.sanitizeConfig(t,e);if("center"===e.target&&(e=scooter.movement.center(t,e)),"origin"===e.target&&(e=scooter.movement.origin(t,e)),e.waypoints&&e.waypoints.length>0){t.state.waypoints=[];for(var i=0;i<e.waypoints.length;i++)t.state.waypoints.push(e.waypoints[i]);t.state.waypointDurations=scooter.calc.findDurations(t,e),t.state.deferredTarget={};for(var r in e)t.state.deferredTarget[r]=e[r];t.state.deferredTarget.duration=t.state.waypointDurations[t.state.waypointDurations.length-1],t.state.deferredTarget.waypoints=!1,t.state.waypointConfig={};for(var r in e)t.state.waypointConfig[r]=e[r];return t.state.waypointConfig.scale=t.state.waypointConfig.travelScale,t.state.waypointConfig.waypoints=!1,t.state.waypointConfig.callback=function(){scooter.movement.dispenseWaypoint(t)},scooter.movement.dispenseWaypoint(t),!1}t.state.currentTarget=e.target,o(e.travelScale,function(){n(function(){o(e.scale,e.callback)})})}})}();